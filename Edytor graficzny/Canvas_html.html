<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

</head>

<body>
    <!-- Ładowanie pliku z komputera na stronę (plik musi być w tym samym folderze, co index) -->
    <img id="testimg" src=""> <br>
    <input id="testfile" type="file"> <br>
    <button onclick=zmiana()>Klik</button>

    <!-- Ładowanie pliku do Canvas -->
    <button id="btn" onclick="draw()">Push me plis</button>
    <button onclick="greyScale()">Szarość</button>

    <!-- Wymiary Canvas TODO wymiary jak ładowane foto -->
    <canvas width="256" height="256" id="canva" style="border: 1px solid #000000;"></canvas>

    <!-- Range TODO zmiana jasności -->
    <input oninput="greyScaleRange()" id="ran" type="range" min="0" max="9" value="0">

    <script>
        let testImg = document.getElementById("testimg")
        let testFile = document.getElementById("testfile")
        function zmiana() {
            testImg.src = testFile.files[0].name
        }
        var canva = document.getElementById('canva')
        var ctx = canva.getContext("2d")
        var img = document.getElementById('testimg')
        function draw() {

            ctx.drawImage(img, 0, 0, canva.width, canva.height);

        }



        //document.querySelector("#btn").addEventListener("click", imageData);

        function greyScale() {
            var imageData = ctx.getImageData(0, 0, canva.width, canva.height)
            var data = imageData.data
            for (var i = 0; i < data.length; i += 4) {
                var brightness = Math.min(255, 0.34 * data[i]) + Math.min(255, 0.5 * data[i + 1]) + Math.min(255, 0.16 * data[i + 2]);
                // red
                data[i] = brightness;
                // green
                data[i + 1] = brightness;
                // blue
                data[i + 2] = brightness;
            }
            ctx.putImageData(imageData, 0, 0)

        }
        //TODO zrobić więcej suwaków dla ctx.filter (https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/filter)
        function greyScaleRange() {
            var range = document.getElementById('ran')
            var imageData = ctx.getImageData(0, 0, canva.width, canva.height)
            var data = imageData.data
            range.addEventListener("mousemove", function() {
                let rangeOldVal = Number(range.value)
                if (range.value !== rangeOldVal) {
                    setBrightness(Number(range.value));
                }
                
            });
            function setBrightness (value) {
                ctx.filter = `brightness(${value * 10 + 100}%)`;
                ctx.drawImage(img, 0, 0)
            }

        }
        
        //modyfikacje tablicy pikseli
        /*for (let i = 0; i < imageData.data.length; i += 3) {
            //R
            imageData.data[i] = Math.min(255, imageData.data[i] + 30)
            //G
            imageData.data[i + 1] = Math.min(255, imageData.data[i + 1] + 30)
            //B
            imageData.data[i + 2] = Math.min(255, imageData.data[i + 2] + 30)
        }
        //wpisujemy pixele do canvasa
        ctx.putImageData(imageData, 0, 0)*/


    </script>
</body>

</html>